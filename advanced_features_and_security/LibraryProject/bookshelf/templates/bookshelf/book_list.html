{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Book List</title>
    <link rel="stylesheet" href="{% static 'bookshelf/styles.css' %}">
</head>
<body>
    <h1>Books</h1>

    <!-- Search Form -->
    <form method="get" action="{% url 'book_list' %}">
        {{ form.q.label_tag }}
        {{ form.q }}
        <button type="submit">Search</button>
    </form>

    <!-- Add Book Button -->
    {% if user.has_perm('bookshelf.can_create') %}
        <p><a href="{% url 'add_book' %}">Add New Book</a></p>
    {% endif %}

    <!-- Books Table -->
    <table border="1" cellpadding="5" cellspacing="0">
        <thead>
            <tr>
                <th>Title</th>
                <th>Author</th>
                <th>Year Published</th>
                {% if user.has_perm('bookshelf.can_edit') or user.has_perm('bookshelf.can_delete') %}
                    <th>Actions</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for book in books %}
                <tr>
                    <td>{{ book.title|escape }}</td>
                    <td>{{ book.author|escape }}</td>
                    <td>{{ book.published_date }}</td>
                    {% if user.has_perm('bookshelf.can_edit') or user.has_perm('bookshelf.can_delete') %}
                        <td>
                            {% if user.has_perm('bookshelf.can_edit') %}
                                <a href="{% url 'edit_book' book.pk %}">Edit</a>
                            {% endif %}
                            {% if user.has_perm('bookshelf.can_delete') %}
                                <form method="post" action="{% url 'delete_book' book.pk %}" style="display:inline;">
                                    {% csrf_token %}
                                    <button type="submit" onclick="return confirm('Are you sure you want to delete this book?');">Delete</button>
                                </form>
                            {% endif %}
                        </td>
                    {% endif %}
                </tr>
            {% empty %}
                <tr>
                    <td colspan="4">No books found.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>
